---
emoji: 🌐
title: 셀룰러 네트워크 4G, 5G
date: '2023-06-10 00:00:00'
author: 최민석
tags: Network, Wireless, 4G, 5G
categories: ComputerNetwork
---
# 셀룰러 네트워크: 4G, 5G

<br/>

### 셀룰러(cellular) 네트워크

- `셀룰러(cellular)`라는 용어는 셀룰러 네트워크의 영역이 전파 도달 능력에 따라 **여러 개의 지리적 영역, 즉** `셀(cell)`**로 나뉜다**는 사실에서 비롯되었다.
- 각각의 셀은 셀 영역 안의 `이동 장치(mobile device)`와 신호를 주고받는 `기지국(base station)`을 갖고 있다.
- 하나의 셀이 담당하는 영역의 넓이는 여러 요소에 의해 영향을 받는다.
    - 기지국과 단말기의 송신 강도
    - 셀 내의 방해가 되는 건물
    - 기지국 안테나의 설치 높이와 종류

<br/>
<br/>

# 4G LTE 셀룰러 네트워크: 구조 및 요소

아래 그림은 `4G LTE(Long-Term Evolution) 네트워크` 구조의 주요 요소를 보여준다.

<br/>

![a1.png](a1.png)

<br/>
<br/>

![a2.png](a2.png)

<br/>
<br/>

### 이동 장치(mobile device)

> 셀룰러 통신 사업자의 네트워크에 연결되는 스마트폰, 태블릿, 랩톱 또는 IoT 장치 등이며, (고정된 온도 세선 또는 감시 카메라도 포함)  
> 웹 브라우저, 지도 앱, 음성 및 화상회의 앱, 모바일 결제 앱 등이 실행되는 곳이다.

- `UE(User Equipment)`
- 전체 `5계층 인터넷 프로토콜 스택`을 구현한다.
- NAT을 통해 얻을 수 있는 `IP 주소`를 갖고 있는 **네트워크의 종단점**이다.
- 전 세계적으로 고유한 `IMSI(International Mobile Subscriber Identity)`라는 64비트의 식별자가 있다.
    - 가입자가 속한 국가 및 홈 네트워크를 포함하여 전 세계의 셀룰러 사업자 시스템에서 가입지를 식별한다. (MAC 주소와 유사함)
    - 이는 `SIM(Subscriber Identity Module) 카드`에 저장된다.
        - SIM 카드는 가입자가 접속할 수 있는 서비스에 대한 정보와 해당 가입자의 키 정보를 암호화한다.

<br/>

### 기지국(base station)

> 셀룰러 통신 사업자 네트워크의 가장자리에 위치하며, 무선 전파 자원 및 담당 영역에 속한 **이동 장치를 관리할 책임이 있다.**

- 이동 장치는 기지국과 상호작용함으로써 사업자의 네트워크에 접속된다.
- 무선 접속 네트워크에서 장치의 인증 및 자원(무선 채널)의 할당 기능을 조정한다.
- 무선 랜의 AP와는 다르게, 셀룰러 기지국에서만 수행하는 역할들은 다음과 같다.
    - AP 이동 장치에서 게이트웨이까지 장치 `고유의 IP 터널`을 생성하고, 셀 간의 장치 이동성을 처리하기 위해 상호작용한다.
    - 인접한 기지국들은 셀 사이의 간섭을 최소화하기 위해 무선 스펙트럼을 관리하기 위한 상호 조정 기능을 수행한다.

<br/>

### 홈 가입자 서버(Home Subscriber Server, HSS)

> HSS의 네트워크를 홈 네트워크로 사용하는 이동 장치에 대한 정보를 저장하는 데이터베이스

- 제어 평면의 요소
- 이동 장치의 인증을 위해 `이동성 관리 개체(MME)`와 함께 사용된다.

<br/>

### S-GW(Serving Gateway), P-GW(Packet data Network Gateway)

`S-GW`와 `PDN 게이트웨이(P-GW)`는 이동 장치와 인터넷 사이에 위치하는 2개의 라우터다.

<br/>

#### PDN 게이트웨이(P-GW)

- 이동 장치에 `NAT IP 주소`를 제공하고 `NAT 기능`을 수행한다.
- 외부 세계에서 P-GW는 다른 게이트웨이 라우터와 마찬가지로 보인다.
- 셀룰러 사업자의 LTE 네트워크 안에서의 이동 노드의 이동성은 P-GW 뒤에 있는 바깥 세상에는 감추어진다.

이러한 게이트웨이 라우터 외에도 셀룰러 사업자의 `all-IP 코어`에는 전통적인 라우터 기능을 수행하는 라우터들이 존재한다.

<br/>

### 이동성 관리 개체(Mobility Management Entity, MME)

- 제어 평면의 요소
- HSS와 함께 네트워크에 접속하려는 장치를 **인증**하는 데 중요한 기능을 수행한다.
- 이동 장치와 PDN 인터넷 게이트웨이 간의 데이터 경로에 터널을 설정하고, 사업자의 셀룰러 네트워크 안에서 활성화된 이동 장치의 셀 위치 정보를 유지 관리한다.  
  그러나 이동 장치의 데이터그램이 인터넷으로 전송되거나 들어오는 전달 경로상에 있지 않다. (아래 그림에서 확인 가능)

<br/>

LTE 데이터 평면과 제어 평면의 요소

![a3.png](a3.png)

<br/>
<br/>

### 인증(authentication)

- 네트워크와 네트워크에 부착된 이동 장치 간의 **상호** 인증
    - 네트워크는 부착된 장치가 실제로 주어진 IMSI와 연관된 장치라는 것을 알아야 한다.
    - 이동 장치는 자신이 부착하고 있는 네트워크가 또한 합법적인 셀룰러 사업자 네트워크라는 것을 알아야 한다.
- `MME`가 이동 홈 네트워크에서 이동 장치와 `홈 가입자 서버 HSS` 사이의 중재자 역할을 한다.
    1. 로컬 MME는 이동 장치로부터 접속 요청을 수신하고, 이동 장치의 홈 네트워크 HSS에 접촉한다.
    2. 이동 장치의 홈 HSS는 로컬 MME에 암호화된 정보를 충분히 반환한다.

<br/>

### 경로 설정(path setup)

> **이동 장치로부터 게이트웨이 라우터로의 데이터 경로**는  
> 이동 장치와 기지국 사이의 무선 첫 번째 홉(first hop), 기지국과 서빙 게이트웨이(S-GW) 사이의 연결된 `IP 터널, 서빙 게이트웨이, PDN 게이트웨이`로 구성된다.

- `터널`은 MME의 제어하에 설정된다.
- **장치가 다른 기지국으로 이동했을 때에 기지국에서 종료하는 터널 종단점만 변경되며,** 다른 터널 종단점 및 터널과 관련된 서비스 품질은 변경되지 않는다.

<br/>

### 셀 위치 추적(cell location tracking)

이동 장치가 셀들 사이를 이동함에 따라, 기지국들은 이동장치의 위치에서 MME를 갱신할 것이다.

하지만 이동 장치가 수면 모드에 있지만 그럼에도 불구하고 셀 사이를 이동하는 경우, 기지국은 더 이상 해당 장치의 위치를 추적할 수 없다.

이 경우 `페이징`이라고 하는 프로세스를 통해 **깨어난 장치를 찾는 것은** `MME`**의 책임이다.**

<br/>
<br/>
<br/>

# 2G에서 3G, 그리고 4G로의 네트워크 구조 변화

### 2G 셀룰러 구조

> 통신 사업자 코어 네트워크를 통한 회선 교환 음성 서비스를 지원

![a4.png](a4.png)

<br/>
<br/>

### 3G 시스템 구조

> 통신 사업자 코어 네트워크를 통해 회선 교환 음성 서비스와 패킷 교환 데이터 서비스를 별도로 지원

![a5.png](a5.png)

<br/>
<br/>

### 4G 시스템 구조

![a6.png](a6.png)

<br/>
<br/>
<br/>
<br/>

# LTE 프로토콜 스택

4G LTE는 `all-IP 네트워크 구조`이다.

따라서 LTE 프로토콜 스택의 상위 계층은 IP, TCP, UDP, 그리고 다양한 애플리케이션 계층 프로토콜들로 구성된다.

<br/>

아래 그림은 LTE 이동 노드, 기지국, 서빙 게이트웨이에서의 `사용자 평면 프로토콜` 스택을 보여준다.

여기서 볼 수 있듯, 사용자 평면 프로토콜 활동의 대부분은 이동 장치와 기지국 사이의 무선 링크에서 발생한다.

<br/>

![a7.png](a7.png)

<br/>
<br/>
<br/>

LTE는 이동 장치의 `링크 계층`을 3개의 부계층으로 나눈다.

<br/>

> 1️⃣ 패킷 데이터 융합(Packet Data Convergence)

- `PDCP(Packet Data Convergence Protocol)`는 무선 링크를 통해 전송되는 비트 수를 줄이기 위해 IP 헤더 압축을 수행한다.
- LTE 이동 장치가 네트워크에 처음 연결될 때  
  이동 장치와 이동성 관리 개체(MME) 사이의 시그널링 메시지 교환을 통해 설정된 키를 사용한 암호화/복호화 기능을 수행한다.

<br/>

> 2️⃣ 무선 링크 제어(Radio Link Control, RLC)

- 링크 계층 프레임에 적용하기에는 너무 큰 `IP 데이터그램`의 송신 시 **단편화** 및 수신시 **재조립**을 수행한다.
- `ACK/NAK 기반 ARQ 프로토콜`의 사용을 통한 링크 계층에서의 **신뢰성 있는 데이터 전송**을 수행한다.

<br/>

> 3️⃣ 매체 접속 제어(Medium Access Control, MAC)

- **전송 스케줄링**을 수행한다. 이는 무선 전송 슬롯의 요청 및 사용 제어를 의미한다.
- MAC 부계층은 추가적인 오류 감지/정정 기능을 수행하는데, 여기에는 **중복 비트 사용을 통한 순방향 오류 정정 기능**이 포함된다.

<br/>
<br/>

위의 그림은 또한 사용자 데이터 경로에서 `터널`의 사용을 보여준다.

1. 터널은 **MME 제어하에** 이동 장치가 처음으로 네트워크에 연결될 때 설정된다.


2. 두 종단점 사이의 각 터널에는 고유한 `터널 종단점 식별자(tunnel endpoint identifier, TEID)`가 있다.

   (1) 기지국은 이동 장치에서 데이터그램을 수신하면 TEID를 포함한 `GPRS 터널링 프로토콜`을 사용하여 데이터그램을 캡슐화하고  
   (2) UDP 세그먼트로 터널의 다른 쪽 끝에 있는 `서빙 게이트웨이`로 보낸다.


3. (1) 수신 측에서 `기지국`은 터널링된 UDP 데이터그램을 캡슐 해제하고  
   (2) 이동 장치로 향하는 IP 데이터그램을 추출하여  
   (3) 무선 홉을 통해 해당 IP 데이터그램을 이동 장치로 전달한다.

<br/>
<br/>
<br/>

# LTE 무선 접속 네트워크

LTE는 `다운스트림 채널`에서 **주파수 분할 다중화와 시분할 다중화를 조합한 기술**을 사용하는데,  
이 기술은 `직교 주파수 분할 다중화(frequency division multiplexing, OFDM)`로 알려져 있다.

<br/>

LTE에서 활성화된 각 이동 장치에는 **하나 이상의 채널 주파수에서 / 하나 이상의 0.5 ms 시간 슬롯이 할당된다.**

<br/>

아래 그림은 4개의 주파수에서 8개의 시간 슬롯을 할당한 것을 보여준다.

- 각 주파수마다 10 ms 프레임 안에 구조화된 20개의 0.5 ms 슬롯
- 음영 표시 : 20 개의 슬롯 중 8개 슬롯의 할당된 모습

<br/>

![a8.png](a8.png)

<br/>
<br/>

- 동일한 주파수에 있든 다른 주파수에 있든, **점점 더 많은 시간 슬롯을 할당함으로써 이동 장치는 점점 더 높은 전송 속도를 달성할 수 있다.**
- 이동 장치 간의 슬롯 (재)할당은 밀리초마다 한 번씩 수행될 수 있다.
- 다른 변조 방식을 사용하면 전송률을 변경할 수도 있다.

<br/>

`이동 장치에 대한 특정 타임 슬롯의 할당`은 LTE 표준에 의해 의무화되어 있지 않으나,  
`어떤 이동 장치가 주어진 주파수에서 주어진 시간 슬롯에 전송하도록 허용될 것인지`에 대한 결정은 LTE 장비 공급자 또는 네트워크 운영자가 제공하는 스케줄링 알고리즘에 의해 결정된다.

<br/>
<br/>
<br/>

# 추가적인 LTE 기능: 네트워크 접속과 전원 관리

### 네트워크 접속

이동 장치가 셀룰러 사업자의 네트워크의 접속하는 절차는 세 단계로 나뉜다.

<br/>

> 1️⃣ 기지국과의 접속

1. 이동 장치는 초기에 모든 주파수 대역의 모든 채널에서 기지국에 의해 5 ms마다 주기적으로 보로드캐스트되는 `기본 동기화 신호`를 검색한다.
2. 기본 동기화 신호가 발견되면 이동 장치는 해당 주파수를 유지하고 `보조 동기화 신호`를 찾는다.
    - 보조 동기화 신호에서 찾은 정보와 몇 가지 추가 단계를 거쳐서  
      이동 장치는 채널 대역폭, 채널 구성 및 해당 기지국의 셀룰러 사업자 정보화 같은 추가 정보를 찾을 수 있다.
3. 위 과정에서 찾은 정보로 무장한 이동 장치는 연결한 `기지국`을 선택하고, 해당 기지국과의 `무선 홉`을 통해 제어 평면의 신호 연결을 설정할 수 있다.

<br/>

> 2️⃣ 상호 인증

- 기지국이 `MME(Mobility Management Entity)`에 접속하여 상호 인증을 수행한다. (이는 8.8.2절에서 자세히 살펴봄)
- 상호 인증을 통해 네트워크는 접속하려는 장치가 실제로 주어진 **IMSI와 연관된 장치**이며,  
  이동 장치는 접속 시도 중인 네트워크가 **합법적인 셀룰러 사업자 네트워크**임을 알 수 있다.
- 상호 인증 단계가 완료되면 MME와 이동 장치가 서로 상호 인증되고, MME도 이동 장치가 연결된 `기지국의 ID`를 알게 된다.

<br/>

> 3️⃣ 매체 이동 장치와 PDN 게이트웨이 간 경로 구성

- `MME`는 PDN 게이트웨이(이동 장치에 대한 NAT 주소도 제공함), 서빙 게이트웨이, 기지국에 연결하여 아래 그림에 포시된 *2개의 터널*을 설정한다.
- 이 단계가 완료되면 이동 장치는 기지국과 연결된 이 터널을 통해 인터넷과 IP 데이터그램을 송수신할 수 있다.

<br/>

![a9.png](a9.png)

<br/>
<br/>

### 전력 관리: 수면 모드

무선 장치는 전력 소모를 최소화하기 위해 (= 데이터 송수신 및 채널 감지를 위해 이동 장치의 회로가 켜져 있어야 하는 시간을 최소화하고자)  
송수신하지 않을 때는 `수면 상태`로 들어갈 수 있다.

<br/>

4G LTE에서 잠자고 있는 이동 장치는 두 가지 수면 상태 중 하나에 있을 수 있다.

- `불연속 수신 상태(discontinuous reception state)`
- `유휴 상태(idle state)`

<br/>

#### 불연속 수신 상태(discontinuous reception state)

- ‘약한 수면’
- 일반적으로 수백 밀리초의 비활성 기간 이후에 시작되는 단계이다.
- 이동 장치와 기지국은 이동 장치가 깨어나기 위한 주기적인 시간을 미리 예약한 후,  
  주기적으로 기지국에서 이동 장치로의 다운스트림 전송을 위해 **채널을 능동적으로 모니터링한다.**
    - 그러나 이 예정된 스케줄링 시간과는 별개로 이동 장치의 무선 부분은 수면 상태일 수 있다.

<br/>

#### 유휴 상태(idle state)

- ‘깊은 수면’
- 이 상태의 잠은 너무 깊어, 이동 장치가 수면 상태인 동안 통신 사업자 네트워크의 새로운 셀로 이동하는 경우 **이전에 결합되었던 기지국에 알릴 필요가 없다.**
- 따라서 이 깊은 잠에서 깨어날 때 이동 장치는  
  MME가 이동 장치가 과거에 마지막으로 결합했던 기지국 근처의 다른 기지국들로 브로드캐스트하는 `페이징 메시지`를 확인하기 위해 (잠재적으로 새로운) 기지국과의 결합을 재설정해야 한다.
    - 이러한 `제어 평면 페이징 메시지`는 기지국에 의해 해당 셀 내의 모든 이동 장치로 브로드캐스트된다.
    - 이는 **어떤 이동 장치가** 패킷을 수신하기 위해 완전히 깨어나야 하고 기지국에 대한 새로운 데이터 평면 연결을 재성정해야 하는지를 나타낸다.

<br/>
<br/>
<br/>

# 글로벌 셀룰러 네트워크: 네트워크들의 네트워크

‘네트워크들의 네트워크’인 `글로벌 셀룰러 네트워크`는 어떻게 구성될까?

아래 그림은 사용자의 스마트폰이 **4G 기지국**을 통해 `홈 네트워크(home network)`에 연결되는 모습을 보여준다.

<br/>

![a10.png](a10.png)

<br/>
<br/>

- 사용자 홈 네트워크는 홈 네트워크에 있는 하나 이상의 `게이트웨이 라우터`를 통해 다른 셀룰러 통신 사업자들의 네트워크와 글로벌 인터넷으로 연결된다.


- 모바일 네트워크 자체는 공용 인터넷 또는 `IPX(Internet Protocol Packet eXchange) 네트워크`를 통해 상호연결된다.
    - `IPX`는 특히 ISP 간 네트워크를 연결하고 데이터를 교환하는 피어링을 위한 인터넷 교환 지점과 유사하게  
      셀룰러 통신 사업자를 상호연결하기 위한 관리 네트워크다.

<br/>
<br/>
<br/>

# 5G 셀룰러 네트워크

> 궁극적인 `광역 데이터 서비스`는 모든 지역에서 지원되며 유비쿼터스, 기가비트 연결 속도, 초저지연, 사용자 및 장치 수에 대한 제한 없는 서비스가 될 것이다.

<br/>

- `5G`는 4G에 비해 대략 10배의 최대 비트 전송률, 10배 빠른 지연 시간, 그리고 100배 이상의 트래픽 용량을 제공할 것으로 예측된다.


- 사용 주파수
    - FR1(450 MHz~6 GHz)
    - FR2(24 GHz~52 GHz) : `밀리미터파 주파수(millimeter wave frequency)`
        - 장점 : 훨씬 빠른 데이터 속도를 허용한다.
        - 단점
            - 기지국에서 수진기까지의 도달 범위가 훨씬 짧기에 농촌 지역에 부적합하며, 도시 지역에는 더 밀집된 기지국 배치를 필요로 한다.
            - 대기 간섭에 매우 취약하다.


- 5G의 `물리 계층(즉, 무선)` 측면은 LTE와 같은 **4G 이동 통신 시스템과 역방향 호환이 되지 않는다.**
    - 기지국 업그레이드나 소프트웨어 업그레이드를 통해 기존 스마트폰을 지원할 수가 없어,  
      5G로의 전환을 위해 이동 통신 사업자는 물리적 인프라에 상당한 투자를 해야 한다.

<br/>
<br/>

## 표준

### eMBB(Enhanced Mobile Broadband)

- 증가된 대역폭과 적당한 지연 시간 감소를 제공한다. (4G LTE와 비교할 때 더 높은 다운로드 및 업로드 속도를 위함)

<br/>

### URLLC(Ultra Reliable Low-Latency Communications)

- 지연 시간에 매우 민감한 애플리케이션을 대상으로 한다. (e.g., 공장 자동화 및 자율 주행)
- 1 ms의 지연 시간을 목표로 한다.

<br/>

### mMTC(Massive Machine Type Communications)

- 감지, 측정 및 모니터링 애플리케이션을 위한 협대역 접속 유형이다.
- IoT 장치의 네트워크 연결 장벽을 낮추기 위해 전력 요구사항을 줄이는 데 중점을 두고 있다.

<br/>
<br/>

## 5G와 밀리미터파 주파수

`24 GHz~52 GHz 대역의 밀리미터파 주파수`는 4G에 비해 데이터 용량이 100배 증가할 수 있는 잠재력을 제공한다.

<br/>

> `데이터 용량(capacity)`  
> = `셀 밀도`(cell density, 셀/km^2 단위)  
> × `가용 스펙트럼`(available spectrum, Hz 단위)  
> × `스펙트럼 효율`(spectral efficiency, 각 기지국이 사용자와 얼마나 효율적으로 통신할 수 있는지, bps/Hz/셀 단위)

<br/>

- 밀리미터 주파수는 4G LTE 주파수보다 범위가 훨씬 짧기에 더 많은 기지국이 필요하다. → **셀 밀도 증가**


- 5G FR2는 4G LTE(최대 약 2 GHz)보다 훨씬 더 큰 주파수 대역(52 - 24 = 24 GHz)에서 작동하기 때문에 **사용 가능한 스펙트럼이 더 많다.**


- 스펙트럼 효율성을 두 배 늘리기 위해 17배의 전력 증가가 필요하지만, 5G는 그 대신 각 기지국에서 다중 안테나를 사용하는 `MIMO 기술`을 사용한다.
    - 신호를 모든 방향으로 브로드캐스트하는 대신, 각 MIMO 안테나는 빔 형성을 통해 사용자에게 신호를 직접 전송한다.
    - 이를 통해 동일한 주파수 대역에서 동시에 10~20명의 사용자에게 전송할 수 있다.

<br/>

그러나 밀리미터파 신호는 건물과 나무에 의해 쉽게 차단되기 때문에  
기지국과 사용자 간의 범위 간격을 메우기 위해서 `스몰 셀 스테이션(small cell station)`이 필요하다.

<br/>
<br/>

## 5G 코어 네트워크(5G Core network)

> 5G 모바일 음성, 데이터 및 인터넷 연결을 모두 관리하는 데이터 네트워크

- 인터넷 및 클라우드 기반 서비스와 더 잘 통합되도록 재설계되었다.
- 네트워크 전체에 분산 서버와 캐시를 포함하여 지연 시간을 줄였다.
- 새로운 5G 코어 사양은 **모바일 네트워크가 다양한 성능으로 다양한 서비스를 지원하는 방식**에 주요한 변화를 도입했다.
    - 종단점 장비로부터의 데이터 트래픽을 중계
    - 장치를 인증
    - 장치의 이동성을 관리
- 모든 네트워크 요소(이동 장치, 셀, 기지국, MME, HSS, 서빙 게이트웨이, PDN 게이트웨이)를 포함한다.

<br/>

### 5G 코어 아키텍처

5G 코어는 **제어 평면과 사용자 평면의 완전한 분리**를 위해 설계되었고, 이는 순전히 가상화된 소프트웨어 기반 네트워크 기능으로 구성된다.

따라서 사업자가 다양한 5G 애플리케이션의 다양한 요구사항을 충족할 수 있는 유연성을 제공한다.

<br/>
<br/>

## 5G 핵심 네트워크 기능들

### 사용자 평면 기능(User-Plane Function, UPF)

제어와 사용자 평면 분리를 통해 패킷 처리를 네트워크 가장자리로 보내 분산시킬 수 있다.

<br/>

### 접속 및 이동성 관리 기능(Access and Mobility Management Function, AMF)

5G 코어는 기본적으로 4G MME를 AMF와 SMF의 두 가지 기능 요소로 분리한다.

AMF는 최종 사용자 장치로부터 모든 연결 및 세션 정보를 수신하지만, 연결 및 이동성 관리 작업만 처리한다.

<br/>

### 세션 관리 기능(Session Management Function, SMF)

세션 관리는 SMF에 의해 처리된다.

제어와 분리된 데이터 평면과의 상호작용을 담당하며, IP 주소 관리를 담당하고 `DHCP 역할`을 수행한다.

<br/>
<br/>

---

<br/>

2020년을 기준으로, 5G는 적용 초기 단계이며 많은 5G 표준들이 아직 확정되지 않았다.

5G가 궁극의 광역 무선 서비스를 향한 커다란 발걸음이 될지는 시간이 지나야 알 수 있을 것이다.

```toc
```
