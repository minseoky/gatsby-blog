---
emoji: π
title: TCP μ—°κ²°μ λ³΄μ• - TLS
date: '2023-06-14 06:00:00'
author: μµλ―Όμ„
tags: Network, Network Security, TLS
categories: ComputerNetwork
---
# TCP μ—°κ²°μ λ³΄μ•: TLS

λ³΄μ• μ„λΉ„μ¤κ°€ μ¶”κ°€λμ–΄ ν–¥μƒλ TCP λ²„μ „μ„ ν”ν `TLS(Transport Layer Security)` λΌκ³  λ¶€λ¥Έλ‹¤.

TLSλ” κΈ°λ°€μ„±, λ°μ΄ν„° λ¬΄κ²°μ„±, μ„λ²„μΈμ¦κ³Ό ν΄λΌμ΄μ–ΈνΈ μΈμ¦μ„ ν†µν•΄ TCPλ¥Ό ν–¥μƒν•μ—¬ λ³΄μ• μ„λΉ„μ¤λ¥Ό μ κ³µν•λ‹¤.

TLSλ” TCPλ¥Ό λ³΄νΈν•κΈ° λ•λ¬Έμ— TCP μƒμ—μ„ μΌμ–΄λ‚λ” μ–΄λ– ν• μ• ν”λ¦¬μΌ€μ΄μ…μ—λ“  μ‚¬μ©λ  μ μλ‹¤.

<br/>

![a1.png](a1.png)

TLSλ” μ†μΌ“μ„ μ‚¬μ©ν•λ” κ°„λ‹¨ν• APIλ¥Ό μ κ³µν•λ”λ°, TCPμ APIμ™€ μ μ‚¬ν•λ‹¤.

TLSλ” μ• ν”λ¦¬μΌ€μ΄μ… κ³„μΈµμ— μ΅΄μ¬ν•λ‚ κ°λ°μμ κ΄€μ μ—μ„λ” λ³΄μ• μ„λΉ„μ¤λ΅ κ°•ν™”λ TCP μ„λΉ„μ¤λ¥Ό μ κ³µν•λ” νΈλμ¤ν¬νΈ ν”„λ΅ν† μ½μ΄λ‹¤.

<br/>

## TLS κ°μ”: almost TLS

TLSλ¥Ό μ΄ν•΄ν•κΈ° μ„ν•΄ TLSμ λ‹¨μν™”λ λ²„μ „μΈ `almost-TLS`λ¥Ό λ¨Όμ € μ„¤λ…ν•λ‹¤.

`almost-TLS` λ” ν•Έλ“μ…°μ΄ν¬, ν‚¤ μ λ„, λ°μ΄ν„° μ „μ†΅μ΄λΌλ” μ„Έ λ‹¨κ³„λ΅ λμ–΄ μλ‹¤.

<br/>

### ν•Έλ“μ…°μ΄ν¬

![a2.png](a2.png)


1. ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„μ™€ TCP μ—°κ²°μ„ μ„¤λ¦½ν•λ‹¤.
2. μ„λ²„κ°€ μ§„μ§ μ„λ²„μΈμ§€ ν™•μΈν•λ‹¤.
   - ν΄λΌμ΄μ–ΈνΈλ” hello λ©”μ‹μ§€λ¥Ό λ³΄λ‚΄κ³ , μ„λ²„λ” CAλ΅λ¶€ν„° μΈμ¦λ μΈμ¦μ„λ¥Ό λ³΄λ‚΄μ–΄ ν΄λΌμ΄μ–ΈνΈλ” μΈμ¦μ„ λ‚΄μ κ³µκ°ν‚¤κ°€ μ„λ²„μ κ²ƒμ΄λΌλ” κ²ƒμ„ λ―Ώμ„ μ μλ‹¤.
3. TLS μ„Έμ…μ— ν•„μ”ν• λ¨λ“  λ€μΉ­ν‚¤λ¥Ό μƒμ„±ν•κΈ° μ„ν•΄ μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈκ°€ μ‚¬μ©ν•  μ£Ό λΉ„λ°€ν‚¤(Master Secret, MS)λ¥Ό μƒμ„±ν•μ—¬ μ „μ†΅ν•λ‹¤.
   - MSλ¥Ό λ³΄λ‚Ό λ•, μ„λ²„μ κ³µκ°ν‚¤λ΅ μ•”νΈν™”ν•μ—¬ EMS(Encrypted Master Secret)λ¥Ό λ§λ“ λ‹¤.
   - μ„λ²„λ” μμ‹ μ κ°μΈν‚¤λ΅ EMSλ¥Ό λ³µνΈν™” ν•μ—¬ MSλ¥Ό μ–»λ”λ‹¤.
   - μ¦‰, λ‘μ€ λ‘λ§ μ•„λ” MSλ¥Ό μ•κ² λλ‹¤.

<br/>

### ν‚¤ μ λ„

κ³µμ ν• MSλ” λ¨λ“  μ•”νΈν™”μ™€ λ°μ΄ν„° λ¬΄κ²°μ„± κ²€μ‚¬λ¥Ό μ„ν• λ€μΉ­ μ„Έμ…ν‚¤λ΅ μ‚¬μ©λ  μ μμΌλ‚ μΌλ°μ μΌλ΅ κ°κ° λ‹¤λ¥Έ μ•”νΈν™” ν‚¤λ¥Ό μ‚¬μ©ν•λ” κ²ƒμ΄ μΆ€ λ” μ•μ „ν•λ‹¤.

λ”°λΌμ„ MSλ¥Ό μ΄μ©ν•μ—¬ 4κ°μ ν‚¤λ¥Ό λ§λ“ λ‹¤.

- E(b) = ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ— λ³΄λ‚΄λ” λ°μ΄ν„°μ— λ€ν• μ„Έμ… μ•”νΈν™” ν‚¤
- M(b) = ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ— λ³΄λ‚΄λ” λ°μ΄ν„°μ— λ€ν• μ„Έμ… HMAC(λ©”μ‹μ§€ μΈμ¦ μ½”λ“) ν‚¤
- E(a) = μ„λ²„κ°€ ν΄λΌμ΄μ–ΈνΈμ— λ³΄λ‚΄λ” λ°μ΄ν„°μ— λ€ν• μ„Έμ… μ•”νΈν™” ν‚¤
- M(a) = μ„λ²„κ°€ ν΄λΌμ΄μ–ΈνΈμ— λ³΄λ‚΄λ” λ°μ΄ν„°μ— λ€ν• μ„Έμ… HMAC(λ©”μ‹μ§€ μΈμ¦ μ½”λ“) ν‚¤

μ΄λ” λ‹¨μν MSλ¥Ό 4κ°μ ν‚¤λ¥Ό μΌκ°μ–΄ μ΄λ£¨μ–΄μ§„λ‹¤.

2κ°μ μ•”νΈν™” ν‚¤λ” λ°μ΄ν„°λ¥Ό μ•”νΈν™”ν•κ³ , 2κ°μ HMAC ν‚¤λ” λ°μ΄ν„° λ¬΄κ²°μ„±μ„ ν™•μΈν•λ” λ° μ‚¬μ©λλ‹¤.

<br/>

### λ°μ΄ν„° μ „μ†΅

TCPλ” λ°”μ΄νΈ μ¤νΈλ¦Ό ν”„λ΅ν† μ½μ΄λ―€λ΅, TLSκ°€ μ• ν”λ¦¬μΌ€μ΄μ… λ°μ΄ν„°λ¥Ό λμ„μ—†μ΄ μ•”νΈν™”ν•κ³  μ•”νΈν™”λ λ°μ΄ν„°λ¥Ό TCPμ— μ‰΄ μƒ μ—†μ΄ μ „λ‹¬ν•λ” κ²ƒμ΄ μμ—°μ¤λ½λ‹¤.

κ·Έλ ‡λ‹¤λ©΄ HMACμ€ μ–Έμ  ν•΄μ•Όν• κΉ?

λ¶„λ…ν•κ±΄ μ „μ²΄ μ„Έμ… μ‹κ°„ λ™μ• μ „μ†΅λ λ¨λ“  λ°μ΄ν„°μ λ¬΄κ²°μ„±μ„ ν™•μΈν•λ” μΌμ΄ TCP μ„Έμ…μ΄ μΆ…λ£λ  λ•κΉμ§€ λ―Έλ¤„λ‘ μ μ—†λ‹¤λ” κ²ƒμ΄λ‹¤.

TLSλ” λ°μ΄ν„° μ¤νΈλ¦Όμ„ λ μ½”λ“λ΅ μΌκ°κ³  κ° λ μ½”λ“μ— λ¬΄κ²°μ„± κ²€μ‚¬λ¥Ό μ„ν• HMACμ„ λ§λ¶™μΈ ν›„ μ΄ `λ μ½”λ“+HMAC`μ„ μ•”νΈν™”ν•λ‹¤.

HMACμ„ μƒμ„±ν•κΈ° μ„ν•΄ ν΄λΌμ΄μ–ΈνΈλ” λ μ½”λ“ λ°μ΄ν„°μ™€ ν‚¤ M(b)λ¥Ό ν•΄μ‹ ν•¨μμ— λ„£λ”λ‹¤.

`λ μ½”λ“+HMAC` κΎΈλ¬λ―Έλ¥Ό μ•”νΈν™” ν•κΈ°μ„ν•΄ E(b) λ¥Ό μ‚¬μ©ν•μ—¬ TCPλ΅ μ „μ†΅ν•λ‹¤.

<br/>

κ·Έλ¬λ‚ λ§μ•½ μΉ¨μ…μκ°€ TCP μ„Έκ·Έλ¨ΌνΈ μ¤νΈλ¦Όμ—μ„ μ¤νΈλ¦Όμ„ μ‚½μ…, μ‚­μ , κµν™ν•  μ μλ‹¤λ©΄ μ„ λ°©λ²•μ€ μ•μ „ν•μ§€ μ•λ‹¤.

μλ¥Όλ“¤μ–΄, μΉ¨μ…μκ°€ 2κ°μ μ„Έκ·Έλ¨ΌνΈ μμ„λ¥Ό λ°”κΎΌ ν›„ TCP μ„Έκ·Έλ¨ΌνΈ λ²νΈκΉμ§€ κ·Έμ— λ§κ² λ³€κ²½ν•μ—¬ μ„λ²„μ— λ³΄λ‚Έλ‹¤λ©΄ μ„λ²„μ TLSλ” λ¬Έμ  μ—†μ΄ μ΄λ¥Ό μ• ν”λ¦¬μΌ€μ΄μ… κ³„μΈµμ— λ„κ²¨μ¤€λ‹¤.

<br/>

TLSλ” μμ„λ²νΈλ¥Ό μ΄μ©ν•΄μ„ μ΄ λ¬Έμ λ¥Ό ν•΄κ²°ν•λ‹¤.

ν΄λΌμ΄μ–ΈνΈλ” μμ„ λ²νΈ μΉ΄μ΄ν„°λ¥Ό μ μ§€ν•λ©° TLS λ μ½”λ“λ¥Ό λ³΄λ‚Ό λ•λ§λ‹¤ ν•λ‚μ”© μ¦κ°€μ‹ν‚¨λ‹¤.

HMACμ„ κ³„μ‚°ν•  λ• `HMAC ν‚¤ M(b)`μ™€ `λ μ½”λ“ λ°μ΄ν„°`μ™€ `μμ„ λ²νΈ`λ¥Ό ν•©μΉ κ²°κ³Όμ ν•΄μ‹λ΅ μ‚¬μ©ν•λ‹¤.

μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈμ μμ„λ²νΈλ¥Ό μ¶”μ ν•΄μ„ μμ‹ μ HMAC κ³„μ‚°μ„ ν•  λ• μ μ ν• μμ„ λ²νΈλ¥Ό ν¬ν•¨μ‹μΌ λ μ½”λ“μ λ°μ΄ν„° λ¬΄κ²°μ„±μ„ ν™•μΈν•λ‹¤.

<br/>

### TLS λ μ½”λ“


![a3.png](a3.png)

μ²« μ„Έ ν•„λ“λ” μ•”νΈν™”λμ§€ μ•λ”λ‹¤.

νƒ€μ… ν•„λ“λ” ν•Έλ“μ…°μ΄ν¬ λ©”μ‹μ§€μΈμ§€ λ°μ΄ν„°λ¥Ό λ‹΄μ€ λ©”μ‹μ§€μΈμ§€ λ‚νƒ€λ‚Έλ‹¤.

<br/>

## TLSμ μ™„μ „ν• κ°λ… : TLS

μ΄μ  μ™„μ „ν• λ²„μ „μ TLSλ¥Ό μ‚΄ν΄λ³΄μ.

### TLS ν•Έλ“μ…°μ΄ν¬

TLSλ” μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈμ—κ² νΉμ • λ€μΉ­ν‚¤ μ•κ³ λ¦¬μ¦μ΄λ‚ κ³µκ°ν‚¤ μ•κ³ λ¦¬μ¦μ„ μ‚¬μ©ν•λ„λ΅ κ°•μ ν•μ§€ μ•λ”λ‹¤.

λ€μ‹  ν•Έλ“μ…°μ΄ν¬ κ³Όμ •μ—μ„ μ•”νΈν™” μ•κ³ λ¦¬μ¦μ„ ν•©μν•κ³ , μ„λ΅μ—κ² λ„μ¤λ¥Ό λ³΄λ‚΄ μ„Έμ…ν‚¤λ¥Ό μƒμ„±ν•λ‹¤.

**μ‹λ‚λ¦¬μ¤**

1. ν΄λΌμ΄μ–ΈνΈλ” λ„μ¤μ™€ ν•¨κ» μμ‹ μ΄ μ§€μ›ν•λ” μ•”νΈν™” μ•κ³ λ¦¬μ¦μ λ©λ΅μ„ λ³΄λ‚Έλ‹¤.
   - λ„μ¤λ¥Ό μ‚¬μ©ν•λ” μ΄μ λ” λ§μ•½ μΉ¨μ…μκ°€ λ¨λ“  λ©”μ‹μ§€λ¥Ό μ—Ώλ“¤μ€ ν›„ κ·Έλ€λ΅ μ„λ²„μ—κ² λ³΄λ‚΄κ² λλ‹¤λ©΄, μμ„λ²νΈλ¥Ό λ‘”λ‹¤κ³  ν•λ”λΌλ„ κ·Έκ²ƒ λν• κ·Έλ€λ΅ μΌμΉν•λ―€λ΅ μ„λ²„μ—μ„λ” λ‘κ°™μ€ λ©”μ‹μ§€λ¥Ό ν•λ² λ” λ“¤μ€ κ²ƒμΌλ΅ μΈμ§€ν•κΈ° λ•λ¬Έμ΄λ‹¤.
   - λ„μ¤λ¥Ό ν¬ν•¨ν•λ©΄ λ¨λ“  λ©”μ‹μ§€λ” μ μΌμ„±μ„ κ°€μ§€κ² λλ―€λ΅ λ³΄μ•μ— μ•μ „ν•΄μ§„λ‹¤.
2. λ©λ΅μΌλ΅λ¶€ν„° μ„λ²„λ” λ€μΉ­ν‚¤ μ•κ³ λ¦¬μ¦, κ³µκ°ν‚¤ μ•κ³ λ¦¬μ¦, HMAC ν‚¤μ™€ ν•¨κ» HMAC μ•κ³ λ¦¬μ¦μ„ μ„ νƒν•λ‹¤.
3. μ„ νƒ κ²°κ³Όμ™€ μΈμ¦μ„, μ„λ²„ λ„μ¤λ¥Ό ν΄λΌμ΄μ–ΈνΈμ—κ² λ³΄λ‚Έλ‹¤.
4. ν΄λΌμ΄μ–ΈνΈλ” μΈμ¦μ„λ¥Ό ν™•μΈν•κ³  μ„λ²„μ κ³µκ°ν‚¤λ¥Ό μ•μ•„λ‚Έ ν›„ `PMS(Pre-Master-Secret)`μ„ μƒμ„±ν•λ‹¤. μ΄ PMSλ¥Ό μ„λ²„μ κ³µκ°ν‚¤λ΅ μ•”νΈν™”ν• ν›„ μ„λ²„μ—κ² λ³΄λ‚Έλ‹¤.
5. ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„λ” κ°™μ€ ν‚¤ μ λ„ ν•¨μλ¥Ό μ‚¬μ©ν•μ—¬ PMSμ™€ λ„μ¤λ΅λ¶€ν„° MSλ¥Ό κ³„μ‚°ν•λ‹¤.
6. μ΄ MSλ” 2κ°μ μ•”νΈν™” ν‚¤μ™€ 2κ°μ HMAC ν‚¤λ¥Ό μƒμ„±ν•κΈ° μ„ν•΄ λ¶„ν• λλ‹¤.
7. μ΄ν›„ λ¨λ“  λ©”μ‹μ§€λ” μ•”νΈν™”λκ³  μΈμ¦λλ‹¤.
8. ν΄λΌμ΄μ–ΈνΈλ” λ¨λ“  ν•Έλ“μ…°μ΄ν¬ λ©”μ‹μ§€μ HMACμ„ μ „μ†΅ν•λ‹¤.
9. μ„λ²„λ” λ¨λ“  ν•Έλ“μ…°μ΄ν¬ λ©”μ‹μ§€μ HMACμ„ μ „μ†΅ν•λ‹¤.
   - 8, 9λ² κ³Όμ •μ€ μ²μ μ•”νΈν™”λμ§€ μ•μ€ λ©”μ‹μ§€μ— λ€ν• μΉ¨μ…μμ μμ •μ„ λ€λΉ„ν•΄μ„ μ§€κΈκΉμ§€ μ£Όκ³  λ°›μ€ λ©”μ‹μ§€μ μΌμΉ λ¶μΌμΉλ¥Ό ν™•μΈν•λ” κ²ƒμ΄λ‹¤.

<br/>

### μ—°κ²° μΆ…λ£

λ‹¨μν λ°”λ΅ TCP FIN μ„Έκ·Έλ¨ΌνΈλ¥Ό λ³΄λ‚΄ μΆ…λ£μ‹ν‚¤λ©΄ λ¬Έμ λ¥Ό λ°μƒμ‹ν‚¬ μλ„ μλ‹¤.

μΉ¨μ…μκ°€ μ„μλ΅ TCP FIN μ„Έκ·Έλ¨ΌνΈλ¥Ό λ³΄λ‚΄ μΆ…λ£μ‹ν‚¤λ” μ λ‹¨ κ³µκ²© λ¬Έμ κ°€ λ°μƒν•λ‹¤.

μ΄λ¥Ό ν•΄κ²°ν•κΈ° μ„ν•΄ λ μ½”λ“μ νƒ€μ… ν•„λ“μ— κ·Έ λ μ½”λ“κ°€ TLS μ„Έμ… μΆ…λ£λ¥Ό μν–‰ν•  κ²ƒμΈμ§€λ¥Ό ν‘μ‹ν•λ‹¤.


```toc
```
